- id: addon_restart
  alias: Restart Addons
  trigger:
  - platform: time
    at: 01:00:00
  action:
  - service: hassio.addon_restart
    data:
      addon:
      - core_letsencrypt
      - a0d7b954_spotify
- id: reboot_host
  alias: Reboot host
  description: Turn the amplifier on and restart the NUC. This is to make sure the
    HDMI is working.
  initial_state: true
  trigger:
  - platform: time
    at: 09:30:00
  condition:
  - condition: time
    weekday:
    - fri
  - condition: state
    entity_id: input_boolean.holiday_mode
    state: 'off'
  - condition: state
    entity_id: input_boolean.party_mode
    state: 'off'
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'on'
  action:
  - service: script.turn_on
    entity_id: script.harmony_music
  - delay:
      minutes: 1
  - service: hassio.host_reboot
- id: after_reboot_host
  alias: After Reboot host
  description: Turn the amplifier off after the reboot in reboot_host
  initial_state: true
  trigger:
  - platform: time
    at: 09:40:00
  condition:
  - condition: time
    weekday:
    - fri
  - condition: state
    entity_id: input_boolean.holiday_mode
    state: 'off'
  - condition: state
    entity_id: input_boolean.party_mode
    state: 'off'
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'on'
  action:
  - service: script.turn_on
    entity_id: script.harmony_off
- id: morning_aircon
  alias: Morning AirCon
  description: ''
  trigger:
  - at: 01:00:00
    platform: time
  condition:
  - condition: state
    entity_id: climate.daikin_ac
    state: cool
  action:
  - service: climate.set_temperature
    data:
      entity_id: climate.daikin_ac
      temperature: 21
  - service: climate.set_fan_mode
    data:
      entity_id: climate.daikin_ac
      fan_mode: Low/Auto
- id: weekend_outside_speakers_on
  alias: Weekend Outside Speakers On
  description: Turns on the outside speakers when the rear bi fold is opened.
  trigger:
  - entity_id: binary_sensor.rear_bifold_door
    platform: state
    to: 'on'
    for:
      seconds: 10
  condition:
  - condition: state
    entity_id: input_boolean.party_mode
    state: 'off'
  - condition: time
    after: 09:30:00
    before: '20:00:00'
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'off'
  - condition: state
    entity_id: media_player.lounge_amp_zone2
    state: 'off'
  - condition: or
    conditions:
    - condition: state
      entity_id: switch.lounge_hub_music
      state: 'on'
    - condition: state
      entity_id: switch.lounge_hub_hassio
      state: 'on'
  action:
  - service: script.outside_speakers_on
  mode: queued
  max: 10
- id: weekend_outside_speakers_off
  alias: Weekend Outside Speakers Off
  description: Turns off the outside speakers if the rear bifold is closed
  trigger:
  - entity_id: binary_sensor.rear_bifold_door
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: input_boolean.party_mode
    state: 'off'
  - condition: state
    entity_id: media_player.lounge_amp_zone2
    state: 'on'
  action:
  - service: script.outside_speakers_off
  mode: queued
  max: 10

- id: bin_week_yellow
  alias: Bin Week Yellow
  trigger:
  - platform: time
    at: "15:00:00"
  condition:
  - condition: time
    weekday:
    - sun
    - mon
  - condition: template
    value_template: '{{((as_timestamp(now()) - as_timestamp("2023-06-05 00:00:00"))/86400)
      | int % 14  == 0}}'
  action:
  - service: notify.mobile_app_s21
    data:
      message: It is yellow bin week.
  - service: notify.mobile_app_natalies_iphone
    data:
      message: It is yellow bin week.

- id: bin_week_red
  alias: Bin Week Red
  trigger:
  - platform: time
    at: "15:00:00"
  condition:
  - condition: time
    weekday:
    - sun
  - condition: template
    value_template: '{{((as_timestamp(now()) - as_timestamp("2023-06-12 00:00:00"))/86400)
      | int % 14  == 0}}'
  action:
  - service: notify.mobile_app_s21
    data:
      message: It is red bin week.
  - service: notify.mobile_app_natalies_iphone
    data:
      message: It is red bin week.

- id: door_bell_chime
  alias: Door Bell Chime
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.g4_doorbell_doorbell
    to: 'on'
  condition:
  - condition: time
    after: 05:30:00
    before: '22:00:00'
  action:
  - service: media_player.play_media
    data:
      media_content_id: /local/doorbell.mp3
      media_content_type: music
      announce: false
    target:
      entity_id:
      - media_player.bedroom_speaker
      - media_player.den_display
      - media_player.workshop_speaker
      - media_player.kitchen_display

- id: door_bell_notification
  alias: Door Bell Notification
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.g4_doorbell_doorbell
    to: 'on'
  condition:
  - condition: time
    after: 05:30:00
    before: '22:00:00'
  action:
  - service: camera.snapshot
    data:
      filename: /config/www/doorbell.png
    entity_id: camera.g4_doorbell_high
  - service: notify.mobile_app_s21
    data:
      message: Someone has pressed the doorbell.
      data:
        image: https://hassio.buktenica.com:8123/local/doorbell.png
        tag: doorbell
        sticky: 'true'
        actions:
          - action: "trigger_gate"
            title: "Gate"
  - service: notify.mobile_app_natalies_iphone
    data:
      message: Someone has pressed the doorbell.
      data:
        image: https://hassio.buktenica.com:8123/local/doorbell.png
        tag: doorbell
        sticky: 'true'
        actions:
          - action: "trigger_gate"
            title: "Gate"

- id: doorbell_gate_action
  alias: Doorbell Gate Action
  description: Open the gate when the door bell notification button is pressed.
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: trigger_gate
  action:
  - service: button.press
    data: {}
    target:
      entity_id: button.vehicle_button
  - service: notify.mobile_app_s21
    data:
      message: clear_notification
      data:
        tag: doorbell

- id: harmony_off
  alias: Harmony Remote Off
  trigger:
  - platform: state
    entity_id:
    - select.harmony_hub_activities
    to: power_off
  condition:
  - condition: state
    entity_id: media_player.spotify_york_spotify
    state: playing
  action:
  - service: media_player.media_pause
    data: {}
    target:
      entity_id: media_player.spotify_york_spotify
- id: '1685076776161'
  alias: Tag Letterbox is scanned
  description: ''
  trigger:
  - platform: tag
    tag_id: 46485bc4-907e-473b-9697-8b330c58c001
  condition: []
  action:
  - service: button.press
    data: {}
    target:
      entity_id: button.vehicle_button
  mode: single
- id: '1685262366338'
  alias: Press Garage Gate Button
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.garage_rear_button
    to: 'off'
  condition: []
  action:
  - service: button.press
    data: {}
    target:
      entity_id: button.vehicle_button
  mode: single

- id: light_downstairs_switch_on
  alias: Light Downstairs Switch On
  description: Turn on the Lounge and Dining lights
  trigger:
    - entity_id: binary_sensor.downstairs_input
      platform: state
  condition:
    - condition: state
      entity_id: light.kitchen
      state: "off"
    - condition: state
      entity_id: light.kitchen_led
      state: "off"
    - condition: state
      entity_id: light.fl
      state: "off"
    - condition: state
      entity_id: light.fr
      state: "off"
    - condition: state
      entity_id: light.rl
      state: "off"
    - condition: state
      entity_id: light.rr
      state: "off"
    - condition: state
      entity_id: light.dining_west
      state: "off"
    - condition: state
      entity_id: light.dining_east
      state: "off"
  action:
    service: light.turn_on
    data:
      entity_id:
        - light.kitchen
        - light.rl
        - light.rr
        - light.dining_west
        - light.dining_east

- id: light_downstairs_switch_off
  alias: Light Downstairs Switch Off
  description: Turn off the Lounge and Dining lights
  trigger:
    - entity_id: binary_sensor.downstairs_input
      platform: state
    condition:
      or:
        - condition: state
          entity_id: light.kitchen
          state: "on"
        - condition: state
          entity_id: light.kitchen_led
          state: "on"
        - condition: state
          entity_id: light.fl
          state: "on"
        - condition: state
          entity_id: light.fr
          state: "on"
        - condition: state
          entity_id: light.rl
          state: "on"
        - condition: state
          entity_id: light.rr
          state: "on"
        - condition: state
          entity_id: light.dining_west
          state: "on"
        - condition: state
          entity_id: light.dining_east
          state: "on"

  action:
    service: light.turn_off
    data:
      entity_id:
        - light.kitchen
        - light.kitchen_led
        - light.fl
        - light.fr
        - light.rl
        - light.rr
        - light.dining_west
        - light.dining_east